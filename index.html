
<!--


<!doctype html>
<html>
    <head>
         <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
        <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
        <script src="https://github.com/gftruj/webzamples/tree/master/arjs/sound/index.html"></script>

    </head>



<body>
 





       <script>
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(function () {
            var welcomeScreen = document.getElementById('welcomeScreen');
            welcomeScreen.classList.add('fadeOut');
            setTimeout(function () {
                welcomeScreen.style.display = 'none'; 
            }, 1000); 
        }, 5000);
    });
</script>



 <a-assets>
     
        <a-asset-item id="immagine" src="assets/39/asset.glb"></a-asset-item>
        <a-asset-item id="depth" src="assets/39/asset.glb"></a-asset-item>


    </a-assets>

  

     <a-scene vr-mode-ui="enabled: false;" loading-screen="enabled: false;" device-orientation-permission-ui="enabled: false"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;" id="scene" embedded gesture-detector >
        
        <a-marker type="pattern" preset="custom" url="assets/39/marker.patt" raycaster="objects: .clickable"
            emitevents="true" cursor="fuse: false; rayOrigin: mouse;" id="markerA"
            markerfound="resetModelOpacity('profondita')" markerlost="startFadeTimer('profondita')">
            
            <a-entity id="profondita" position="0 0 0" scale="1 1 1" gltf-model="#depth" class="clickable" gesture-handler="0 0 0" animation-mixer="loop: repeat"></a-entity>
                
        </a-marker>



        <a-entity camera></a-entity>
    </a-scene>
         







    </body>
</html>


-->



<html>
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <script>
        AFRAME.registerComponent('rotation-reader', {
            tick: (function () {
                var position = new THREE.Vector3();
                var quaternion = new THREE.Quaternion();

                return function () {
                    this.el.object3D.getWorldPosition(position);
                    this.el.object3D.getWorldQuaternion(quaternion);

                    console.log('Posizione:', position);
                    console.log('Rotazione (quaternion):', quaternion);
                };
            })()
        });

        // Modifica: memorizza la posizione e sposta solo su comando
        AFRAME.registerComponent('move-to-position', {
            schema: {
                target: {type: 'vec3'}
            },
            init: function () {
                var el = this.el;
                var cameraEl = document.querySelector('[camera]');
                var selectedPosition = null;

                el.addEventListener('click', function (evt) {
                    // Memorizza la posizione cliccata
                    selectedPosition = evt.detail.intersection.point;
                    console.log('Posizione selezionata:', selectedPosition);
                });

                // Aggiungi un listener per spostarsi su comando
                document.querySelector('#move-button').addEventListener('click', function () {
                    if (selectedPosition) {
                        // Sposta la telecamera alla posizione memorizzata
                        cameraEl.setAttribute('animation', {
                            property: 'position',
                            to: selectedPosition.x + ' ' + 1.8 + ' ' + selectedPosition.z,
                            dur: 1000,
                            easing: 'easeInOutQuad'
                        });
                    }
                });
            }
        });

        AFRAME.registerComponent('open-text-window', {
            schema: {
                message: {type: 'string', default: ''}
            },
            init: function () {
                var el = this.el;
                var data = this.data;

                el.addEventListener('click', function () {
                    var existingText = document.querySelector('#text-message');
                    if (existingText) {
                        existingText.parentNode.removeChild(existingText);
                    }

                    var textEntity = document.createElement('a-entity');
                    textEntity.setAttribute('id', 'text-message');
                    textEntity.setAttribute('geometry', 'primitive: plane; height: auto; width: auto');
                    textEntity.setAttribute('material', 'color: white');
                    textEntity.setAttribute('text', {
                        value: data.message,
                        color: 'black',
                        width: 4,
                        align: 'center'
                    });

                    var cameraEl = document.querySelector('[camera]');
                    var cameraPosition = cameraEl.object3D.position;

                    textEntity.setAttribute('position', {
                        x: cameraPosition.x,
                        y: cameraPosition.y + 1.8,
                        z: cameraPosition.z - 3
                    });

                    textEntity.setAttribute('follow-camera', '');

                    document.querySelector('a-scene').appendChild(textEntity);
                });
            }
        });

        AFRAME.registerComponent('follow-camera', {
            tick: function () {
                var cameraEl = document.querySelector('[camera]');
                var cameraPosition = cameraEl.object3D.position;
                var cameraRotation = cameraEl.object3D.rotation;

                this.el.object3D.position.set(
                    cameraPosition.x,
                    cameraPosition.y + 1.8,
                    cameraPosition.z - 3
                );
                this.el.object3D.rotation.set(
                    cameraRotation.x,
                    cameraRotation.y,
                    cameraRotation.z
                );
            }
        });
    </script>
</head>
<body>
    <a-scene>
    
        <!-- Caricamento degli asset -->
        <a-assets>
            <a-asset-item id="my-model" src="assets/GPS/PIAZZALE SANTUARIO Definitivo.glb"></a-asset-item>
        </a-assets>
    
        <!-- Posizionamento del modello 3D nella scena -->
        <a-entity class="clickable" position="0 1 -3" rotation="0 45 0" scale="1 1 1" 
                  gltf-model="#my-model" rotation-reader open-text-window="message: This is my GLB model!">
        </a-entity>
    
        <!-- Piano per la scena -->
        <a-plane position="0 0 -4" rotation="-90 0 0" width="1000" height="500" color="#DE0000" class="clickable" move-to-position></a-plane>
        <a-plane position="0 0 0" rotation="-90 0 0" width="500" height="1000" color="#DE0000" class="clickable" move-to-position></a-plane>
    
        <a-sky color="#0000FF"></a-sky>
    
        <!-- Camera e cursore -->
        <a-entity camera look-controls wasd-controls position="0 1.8 0">
            <a-cursor color="yellow"></a-cursor>
        </a-entity>
    </a-scene>

    <!-- Aggiungi un pulsante per spostarsi manualmente -->
    <button id="move-button" style="position: absolute; top: 20px; left: 20px; z-index: 999;">
        Vai alla posizione selezionata
    </button>
</body>
</html>
